<!DOCTYPE html>
<html lang="en">

<head>
    <meta property="og:type" content="website" />
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>中國信託銀行母親賀卡</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
        crossorigin="anonymous">
    <!-- Bootstrap CSS -->
</head>
<style>
    .resize-container {
        /* 最大的div把圖片成功合成 */
        position: relative;
        /*relative  */
        width: 100%;
        /* 769 */
        height: 100%;
        /* 960 */
    }

    .bgimg_ciclk {
        /* 選擇背景btn */
        top: 90%;
        left: 50%;
        height: 30px;
        width: 80px;
        margin-top: -15px;
        margin-left: -40px;
        position: absolute;
        font-family: Microsoft JhengHei;
    }



    @media screen and (max-width: 640px) {
        /*  X<640 手機尺寸 */
        body {
            background-color: aqua;
        }
        #back {
            /* 固定的背景 */
            position: relative;
            display: inline-block;
            width: 100%;
            height: 100%;
        }


    }

    @media screen and (min-width: 641px) and (max-width: 980px) {
        /*  641<X<980 平板尺寸 */
        body {
            background-color: blueviolet;
        }


    }

    @media screen and (min-width: 981px) and (max-width: 1920px) {
        /*  981<X<1920 電腦尺寸 */
        body {
            background-color: rgb(150, 179, 25);
        }

    }


    /* 限制大小的css*/
</style>

<body>

    <div id="carouselExampleControls" class="carousel slide" data-ride="carousel">
        <div class="carousel-inner">

            <div class="carousel-item active">
                <fieldset>
                    <input type="button" class="bgimg_ciclk" value="選擇背景" onclick="showPreview(this,1,'back')">
                </fieldset>

                <img id="bg1" class="d-block w-100" src="img\b1.png" alt="First slide" onclick="showPreview(this, 1,'back')">
            </div>

            <div class="carousel-item">
                <fieldset>
                    <input type="button" class="bgimg_ciclk" value="選擇背景" onclick="showPreview(this,3,'back')">
                </fieldset>
                <img id="bg2" class="d-block w-100" src="img\b2.png" alt="Second slide" onclick="showPreview(this, 3,'back')">
            </div>

            <div class="carousel-item">
                <fieldset>
                    <input type="button" class="bgimg_ciclk" value="選擇背景" onclick="showPreview(this,5,'back')">
                </fieldset>
                <img id="bg3" class="d-block w-100" src="img\b3.png" alt="Third slide" onclick="showPreview(this, 5,'back')">
            </div>

            <div class="carousel-item">
                <fieldset>
                    <input type="button" class="bgimg_ciclk" value="選擇背景" onclick="showPreview(this,7,'back')">
                </fieldset>
                <img id="bg4" class="d-block w-100" src="img\b4.png" alt="Third slide" onclick="showPreview(this, 7,'back')">
            </div>

            <div class="carousel-item">
                <fieldset>
                    <input type="button" class="bgimg_ciclk" value="選擇背景" onclick="showPreview(this,9,'back')">
                </fieldset>
                <img id="bg5" class="d-block w-100" src="img\b5.png" alt="Third slide" onclick="showPreview(this, 9,'back')">
            </div>

            <div class="carousel-item">
                <fieldset>
                        <input type="button" class="bgimg_ciclk" value="選擇背景" onclick="showPreview(this,11,'back')">
                </fieldset>

                <img id="bg6" class="d-block w-100" src="img\b6.png" alt="Third slide" onclick="showPreview(this, 11,'back')">
            </div>

        </div>
        <a class="carousel-control-next" href="#carouselExampleControls" role="button" data-slide="next">
            <img src="img\icon-arrow-right-b-128.png" class="carousel-control-next-icon" aria-hidden="true">
            <span class="sr-only">Next</span>
        </a>
        <a class="carousel-control-prev" href="#carouselExampleControls" role="button" data-slide="prev">
            <img src="img\icon-arrow-left-b-128.png" class="carousel-control-next-icon" aria-hidden="true">
            <span class="sr-only">Previous</span>
        </a>
    </div>

</body>

<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
<!-- 引用jq -->
<script src="js/html2canvas.js"> </script>
<!-- 從本地端引入 html2canvas 0.4.1版 這個插件的方法，可以將整個節點繪製成畫布 -->

<!-- <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
    crossorigin="anonymous"></script> -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
    crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
    crossorigin="anonymous"></script>
<script>
    var scale = 1,
        gestureArea = document.getElementById('contoller'); /*控制圖片的div*/
    let complete_img; //完整的圖片URL
    var img; //圖片拿出
    var bg_img; //選到的背景資訊
    function showPreview(source, imgId, back) { //上傳圖片 imgId = 第幾張背景
        console.log("this img: ",source.src);
        // var img = new Image();
        // console.log(event.target.src);
        var x = imgId; //這裡要拿到哪一張圖
        var info = document.getElementsByClassName("carousel-item");

        bg_img = $(info).children().get(x).src; //給到外面變數
        localStorage.bgimg = bg_img; // 把本地背景
        location.href = "uploadorshare.html";//完成後跳轉到uploadorshare 頁面


    }
    function getCanvasBase64(img) {
        var image = new Image();
        //至關重要
        image.crossOrigin = '';
        image.src = img;
        //至關重要
        var deferred = $.Deferred();
        if (img) {
            image.onload = function () {
                deferred.resolve(getBase64Image(image));//將base64傳給done上傳處理
                // document.getElementById("container2").appendChild(image);
            }
            return deferred.promise();//問題要讓onload完成後再return sessionStorage['imgTest']
        }
    }

    function getBase64Image(img, width, height) {
        var canvas = document.createElement("canvas");
        canvas.width = width ? width : img.width;
        canvas.height = height ? height : img.height;
        var ctx = canvas.getContext("2d");
        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
        var dataURL = canvas.toDataURL();
        return dataURL;
    }

    function fileshow(source, imgId) { //上傳圖片 this替代成 source 指的這個input 
        // console.log( $(source).children() );
        var file = source.files[0]; //傳進的檔案
        console.log(file.type); //檔案類型  
        if (window.FileReader) {
            var fr = new FileReader(); //開啟檔案
            fr.onloadend = function (e) { //讀檔放入 背景沒有這樣做所以沒有合成成功
                console.log(e.target.result);
                document.getElementById(imgId).src = e.target.result; // 放到DOM元素 = 當前傳進的目標
            }
            fr.readAsDataURL(file); // 即將被讀取的Blob或File對象
        }
    }

    function ajaxUpLoad(file) { // file = base64的前端img
        $.ajax({
            type: "POST",
            url: 'http://211.23.17.100:3005', // 這裡打KOA後端
            async: true,
            data: { img: file }, // img(key):file(value)
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            success: function (data) { //拿到成功的存儲圖片(http) 
                console.log("成功: ", data.url);//data.url = 合成好的圖片
                img = data.url; //成功拿到合成照片的資料
                localStorage.bgimg = data.url;
                console.log("選擇好的背景:  ", localStorage.bgimg); //選擇好的圖片到 upload or share 頁面
                location.href = "uploadorshare.html";//完成後跳轉到uploadorshare 頁面
                // console.log(" 合成好的圖片 ", localStorage.CombinePicture);//印出localStorage.CombinePicture
            },
            error: function (err) {
                console.log("錯誤: ", err);
            }
        });
    }


</script>

</html>